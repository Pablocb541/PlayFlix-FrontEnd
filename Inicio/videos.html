<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playlist</title>
  <link rel="stylesheet" href="/styles/videos.css">
</head>
<body>
  <div class="navbar">
    <a href="login.html" onclick="logout()">Cerrar Sesión</a>
    <a href="administrador.html" onclick="backToProfiles()">Perfiles</a>
  </div>

  <h1>Playlist</h1>

  <!-- Contenedor donde se mostrarán los videos -->
  <div id="videoContainer"></div>

  <script>
    // Clase para extraer y mostrar los videos
    class YouTubeLinkExtractor {
      constructor(apiUrl) {
        this.apiUrl = apiUrl;
      }

      async fetchVideos(userId) {
        try {
          const response = await fetch(`${this.apiUrl}?userId=${userId}`); // Envía el ID de usuario como parámetro
          const data = await response.json();
          return data;
        } catch (error) {
          console.error('Error fetching videos:', error);
          return [];
        }
      }

      async renderVideos(containerId, userId) {
        const videos = await this.fetchVideos(userId);
        const container = document.getElementById(containerId);
        if (!container) {
          console.error(`Container element with ID ${containerId} not found.`);
          return;
        }
        container.innerHTML = ''; // Limpiar el contenedor antes de agregar los videos

        for (let i = 0; i < videos.length; i++) {
          const video = videos[i];
          const videoId = this.extractVideoId(video.youtubeUrl);
          const videoContainer = document.createElement('div');
          videoContainer.classList.add('video-container');

          // Agregar evento de clic al contenedor de video
          videoContainer.addEventListener('click', () => {
            // Cambiar el tamaño del iframe para que se vea más grande
            const iframe = document.createElement('iframe');
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&loop=1&playlist=${videoId}`;
            iframe.title = 'YouTube video player';
            iframe.frameBorder = '0';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
            iframe.allowFullscreen = true;
            videoContainer.innerHTML = '';
            videoContainer.appendChild(iframe);
          });
          
          const thumbnail = document.createElement('img');
          thumbnail.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
          thumbnail.alt = 'Video Thumbnail';
          thumbnail.classList.add('video-thumbnail');

          const overlay = document.createElement('div');
          overlay.classList.add('video-overlay');
          overlay.innerHTML = `
            <div class="video-title">${video.name}</div>
          `;

          videoContainer.appendChild(thumbnail);
          videoContainer.appendChild(overlay);

          container.appendChild(videoContainer);
        }
      }

      extractVideoId(youtubeUrl) {
        const url = new URL(youtubeUrl);
        const videoId = url.searchParams.get('v');
        return videoId;
      }
    }

    // Obtener el ID de usuario del localStorage
    const userId = localStorage.getItem('userId');

    // Uso de la clase YouTubeLinkExtractor
    const extractor = new YouTubeLinkExtractor('http://localhost:3000/api/videos');
    extractor.renderVideos('videoContainer', userId);
  </script>
</body>
</html>
